<html>
<head>
    {% load static %}
    <script src="https://unpkg.com/htmx.org@2.0.2" integrity="sha384-Y7hw+L/jvKeWIRRkqWYfPcvVxHzVzn5REgzbawhxAuQGwX1XWe70vji+VSeHOThJ" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script>

            // Record the click on a response button 
            function record(buttonID) {
                return function () {
                    id = document.getElementById(buttonID)
                    val = document.getElementById("times").value
                    val = val + ` ${id.innerText}:${Date.now()}`
                    document.getElementById("times").value = val
                }
            }

            // Change an HTML element from visible to invisible
            // and vice versa
            function togglevisibility(id) {
                element = document.getElementById(id)
                if (element.style.display === "none") {
                    element.style.display = "block";
                } else {
                    element.style.display = "none";
                }
            }
            
            // Toggle the visibility of all buttons
            function toggle() {
                togglevisibility("play")
                togglevisibility("button1")
                togglevisibility("button2")
                togglevisibility("button3")
                togglevisibility("buttonA")
                togglevisibility("buttonB")
                togglevisibility("buttonC")
                togglevisibility("next")
            }
        
            // Play audio. Make buttons visible upon completion
            function playaudio() {

                document.getElementById("answer").innerText=""
                x = "{% static '312.m4a' %}"
                stimulus = new Audio(x)
                stimulus.addEventListener("ended", function(){
                    toggle()
                    document.getElementById("times").value=`${Date.now()}`
                });

                stimulus.addEventListener("play", function(){
                    document.getElementById("answer").innerText=""
                });

                stimulus.play()
            }

            // Setup record function for response buttons
            addEventListener("DOMContentLoaded", (event) => {
                document.getElementById("button1").onclick = record("button1")
                document.getElementById("button2").onclick = record("button2")
                document.getElementById("button3").onclick = record("button3")
                document.getElementById("buttonA").onclick = record("buttonA")
                document.getElementById("buttonB").onclick = record("buttonB")
                document.getElementById("buttonC").onclick = record("buttonC")

            });
        
    </script>


</head>



<body hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>

<h2> HTMX + Javascript Demo</h2>

<button id="play" onclick="playaudio()">
    Stimulus  
</button>
<br><br>
<table>
<tr>
    <td>
        <button type="button" class="btn btn-outline-dark" id="button1" style="display: none">
            1
        </button>
    </td>
    <td>
        <button type="button" class="btn btn-outline-dark" id="button2" style="display: none">
            2
        </button>
    </td>
    <td>
        <button type="button" class="btn btn-outline-dark" id="button3" style="display: none">
            3
        </button>
    </td>
</tr>
<tr>
    <td>
        <button type="button" class="btn btn-outline-dark" id="buttonA" style="display: none">
            A
        </button>
    </td>
    <td>
        <button type="button" class="btn btn-outline-dark" id="buttonB" style="display: none">
            B
        </button>
    </td>
    <td>
        <button type="button" class="btn btn-outline-dark" id="buttonC" style="display: none">
            C
        </button>
    </td>
</tr>
</table>

<br><br>

<input id="times" value="" type="hidden" name="times"  ></input>

<button id="next" style="display: none" 
hx-trigger="click" hx-post="{% url 'htmx:response' %}" hx-include="#times" 
hx-target="#times" hx-swap="outerHTML"
hx-on::after-request="toggle()">
    Next  
</button>

<div id="answer"></div>

</body>
</html>
